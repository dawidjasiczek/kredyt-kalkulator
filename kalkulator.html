<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <title>Kalkulator kredytu – 2 zakładki</title>
  <!-- Bootstrap CSS (CDN) -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  >
</head>
<body class="bg-light">
<div class="container my-4">

  <!-- NAVIGACJA (Zakładki) -->
  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <!-- Zakładka 1 -->
    <li class="nav-item" role="presentation">
      <button
        class="nav-link active"
        id="tab1-tab"
        data-bs-toggle="tab"
        data-bs-target="#tab1"
        type="button" role="tab"
        aria-controls="tab1"
        aria-selected="true"
      >
        Porównanie 3 scenariuszy (stałe oprocentowanie & nieruchomość)
      </button>
    </li>
    <!-- Zakładka 2 -->
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="tab2-tab"
        data-bs-toggle="tab"
        data-bs-target="#tab2"
        type="button" role="tab"
        aria-controls="tab2"
        aria-selected="false"
      >
        Automatyczna symulacja (min./max. wkład, max. płatność)
      </button>
    </li>
  </ul>

  <div class="tab-content" id="myTabContent">

    <!-- Zawartość zakładki 1 -->
    <div class="tab-pane fade show active" id="tab1" role="tabpanel" aria-labelledby="tab1-tab">
      <!-- ZAWARTOŚĆ: Porównanie 3 scenariuszy -->
      <div class="container px-0 py-3">
        <h2 class="mb-4">Porównanie 3 scenariuszy kredytowych z jedną wartością nieruchomości i oprocentowaniem</h2>
        <p>
          Poniższa sekcja zakłada, że wartość nieruchomości oraz oprocentowanie roczne
          są wspólne dla wszystkich trzech scenariuszy. W każdym scenariuszu możesz zmienić
          wkład własny, okres spłaty i miesięczną nadpłatę.
        </p>

        <!-- PARAMETRY WSPÓLNE -->
        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <label for="propertyValue" class="form-label">Wartość nieruchomości + remont (zł, wspólna)</label>
            <input type="number" class="form-control" id="propertyValue" value="500000" step="0.01">
          </div>
          <div class="col-md-4">
            <label for="yearlyInterestRate" class="form-label">Oprocentowanie roczne (%)</label>
            <input type="number" class="form-control" id="yearlyInterestRate" value="7.9" step="0.01">
          </div>
        </div>

        <!-- SCENARIUSZE OBOK SIEBIE -->
        <div class="row g-3">
          <!-- SCENARIUSZ 1 -->
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Scenariusz 1</h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <label for="ownContribution1" class="form-label">Wkład własny (zł)</label>
                  <input type="number" class="form-control" id="ownContribution1" value="300000" step="0.01">
                </div>
                <div class="mb-3">
                  <label for="loanTermYears1" class="form-label">Okres spłaty (lata)</label>
                  <input type="number" class="form-control" id="loanTermYears1" value="35">
                </div>
                <div class="mb-3">
                  <label for="monthlyOverpayment1" class="form-label">Miesięczna nadpłata (zł)</label>
                  <input type="number" class="form-control" id="monthlyOverpayment1" value="0" step="0.01">
                </div>
              </div>
            </div>
          </div>

          <!-- SCENARIUSZ 2 -->
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Scenariusz 2</h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <label for="ownContribution2" class="form-label">Wkład własny (zł)</label>
                  <input type="number" class="form-control" id="ownContribution2" value="250000" step="0.01">
                </div>
                <div class="mb-3">
                  <label for="loanTermYears2" class="form-label">Okres spłaty (lata)</label>
                  <input type="number" class="form-control" id="loanTermYears2" value="30">
                </div>
                <div class="mb-3">
                  <label for="monthlyOverpayment2" class="form-label">Miesięczna nadpłata (zł)</label>
                  <input type="number" class="form-control" id="monthlyOverpayment2" value="500" step="0.01">
                </div>
              </div>
            </div>
          </div>

          <!-- SCENARIUSZ 3 -->
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Scenariusz 3</h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <label for="ownContribution3" class="form-label">Wkład własny (zł)</label>
                  <input type="number" class="form-control" id="ownContribution3" value="200000" step="0.01">
                </div>
                <div class="mb-3">
                  <label for="loanTermYears3" class="form-label">Okres spłaty (lata)</label>
                  <input type="number" class="form-control" id="loanTermYears3" value="35">
                </div>
                <div class="mb-3">
                  <label for="monthlyOverpayment3" class="form-label">Miesięczna nadpłata (zł)</label>
                  <input type="number" class="form-control" id="monthlyOverpayment3" value="2000" step="0.01">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- PRZYCISK DO OBLICZANIA -->
        <div class="row mt-4">
          <div class="col-12">
            <button type="button" class="btn btn-primary" onclick="calculateAll()">Oblicz</button>
          </div>
        </div>

        <!-- WYNIKI -->
        <div id="results-section" class="mt-5" style="display: none;">
          <h3>Wyniki porównania</h3>
          <div class="card">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-bordered table-striped align-middle">
                  <thead class="table-light">
                    <tr>
                      <th style="width: 25%">Parametr / Wynik</th>
                      <th class="text-center">Scenariusz 1</th>
                      <th class="text-center">Scenariusz 2</th>
                      <th class="text-center">Scenariusz 3</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <th scope="row">Kwota kredytu</th>
                      <td class="text-center" id="loanAmount1"></td>
                      <td class="text-center" id="loanAmount2"></td>
                      <td class="text-center" id="loanAmount3"></td>
                    </tr>
                    <tr>
                      <th scope="row">Miesięczna rata bazowa (bez nadpłaty)</th>
                      <td class="text-center" id="baseMonthlyPayment1"></td>
                      <td class="text-center" id="baseMonthlyPayment2"></td>
                      <td class="text-center" id="baseMonthlyPayment3"></td>
                    </tr>
                    <tr>
                      <th scope="row">Całkowita wpłata w każdym miesiącu (rata + nadpłata)</th>
                      <td class="text-center" id="monthlyPaymentPlusOver1"></td>
                      <td class="text-center" id="monthlyPaymentPlusOver2"></td>
                      <td class="text-center" id="monthlyPaymentPlusOver3"></td>
                    </tr>
                    <tr>
                      <th scope="row">Liczba rat (mies./lata)</th>
                      <td class="text-center" id="finalInstallments1"></td>
                      <td class="text-center" id="finalInstallments2"></td>
                      <td class="text-center" id="finalInstallments3"></td>
                    </tr>
                    <tr>
                      <th scope="row">Koszt odsetek</th>
                      <td class="text-center" id="totalInterest1"></td>
                      <td class="text-center" id="totalInterest2"></td>
                      <td class="text-center" id="totalInterest3"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="alert alert-info mt-3">
                <strong>Uwaga:</strong> Każdy scenariusz ma inną strukturę spłaty
                w zależności od indywidualnych parametrów (wkład, okres, nadpłata).
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Zawartość zakładki 2 -->
    <div class="tab-pane fade" id="tab2" role="tabpanel" aria-labelledby="tab2-tab">
      <div class="container px-0 py-3">
        <h2 class="mb-4">Automatyczna symulacja (min./max. wkład, max. płatność)</h2>
        <p>
          Tutaj możesz określić minimalny i maksymalny wkład własny oraz maksymalną kwotę,
          jaką jesteś w stanie miesięcznie płacić (rata + nadpłaty łącznie).
          Skrypt spróbuje wygenerować różne warianty spłaty i wybrać 3 najkorzystniejsze
          pod kątem łącznego kosztu odsetek. Dla uproszczenia ograniczymy się do kilku
          standardowych okresów kredytowych (np. 15, 20, 25, 30, 35 lat) i co pewien krok
          wkładu własnego.
        </p>

        <!-- Ustawienia symulacji -->
        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <label for="propertyValueAuto" class="form-label">Wartość nieruchomości (zł)</label>
            <input
              type="number"
              class="form-control"
              id="propertyValueAuto"
              value="500000"
              step="0.01"
            >
          </div>
          <div class="col-md-4">
            <label for="yearlyInterestRateAuto" class="form-label">Oprocentowanie roczne (%)</label>
            <input
              type="number"
              class="form-control"
              id="yearlyInterestRateAuto"
              value="7.9"
              step="0.01"
            >
          </div>
          <div class="col-md-4">
            <label for="minWklad" class="form-label">Minimalny wkład własny (zł)</label>
            <input
              type="number"
              class="form-control"
              id="minWklad"
              value="100000"
              step="10000"
            >
          </div>
          <div class="col-md-4">
            <label for="maxWklad" class="form-label">Maksymalny wkład własny (zł)</label>
            <input
              type="number"
              class="form-control"
              id="maxWklad"
              value="300000"
              step="10000"
            >
          </div>
          <div class="col-md-4">
            <label for="maxMonthlyPayment" class="form-label">Maksymalna łączna płatność miesięczna (zł)</label>
            <input
              type="number"
              class="form-control"
              id="maxMonthlyPayment"
              value="3000"
              step="100"
            >
          </div>
        </div>

        <button class="btn btn-success" onclick="calculateSmartScenarios()">
          Znajdź 3 najkorzystniejsze warianty
        </button>

        <!-- Wyniki symulacji -->
        <div id="autoResultsSection" class="mt-5" style="display:none;">
          <h3>Najlepsze 3 warianty (według najniższego kosztu odsetek)</h3>
          <div class="table-responsive">
            <table class="table table-bordered table-striped align-middle">
              <thead class="table-light">
                <tr>
                  <th>#</th>
                  <th>Okres (lata)</th>
                  <th>Wkład własny (zł)</th>
                  <th>Kwota kredytu (zł)</th>
                  <th>Liczba rat (mies./lata)</th>
                  <th>Miesięczna rata (bez nadpłaty)</th>
                  <th>Nadpłata (zł)</th>
                  <th>Łączny koszt odsetek</th>
                  <th>Łączna płatność miesięczna (rata + nadpłata)</th>
                </tr>
              </thead>
              <tbody id="autoResultsTableBody">
                <!-- Tutaj wypełnimy dane JS-em -->
              </tbody>
            </table>
          </div>
          <div class="alert alert-info">
            <strong>Uwaga:</strong> Ze względu na uproszczoną metodę przeszukiwania możliwych wartości,
            wyniki mogą nie być w pełni wyczerpujące. Traktuj to jako podgląd możliwości.
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript (Bootstrap + własny) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* 
  ===============================
  KOD ZAKŁADKI 1
  ===============================
*/

/**
 * Oblicza liczbę rat i sumę odsetek dla podanych parametrów.
 * Pozwala na comiesięczną nadpłatę.
 */
function calculateScenario(propertyValue, yearlyInterestRate_h, ownContribution, loanTermYears, monthlyOverpayment) {
  const loanAmount = propertyValue - ownContribution;
  const monthlyInterestRate = (yearlyInterestRate_h / 100.0) / 12.0;
  const totalInstallments = loanTermYears * 12;

  // Rata bazowa bez nadpłaty (rata annuitetowa)
  let baseMonthlyPayment;
  if (monthlyInterestRate > 0) {
    baseMonthlyPayment = loanAmount *
      (monthlyInterestRate * Math.pow(1 + monthlyInterestRate, totalInstallments)) /
      (Math.pow(1 + monthlyInterestRate, totalInstallments) - 1);
  } else {
    // gdy oprocentowanie 0%
    baseMonthlyPayment = loanAmount / totalInstallments;
  }

  // Symulacja spłaty z nadpłatą
  let balance = loanAmount;
  let totalInterest = 0.0;
  let monthCount = 0;

  while (balance > 0) {
    monthCount++;
    const interestPart = balance * monthlyInterestRate;
    let payment = baseMonthlyPayment + monthlyOverpayment;

    if (payment > balance + interestPart) {
      payment = balance + interestPart;
    }
    const capitalPart = payment - interestPart;
    balance -= capitalPart;
    totalInterest += interestPart;

    // Zabezpieczenie w razie dziwnych danych
    if (monthCount > 1200) {
      console.warn("Przekroczono 1200 rat – przerwano obliczenia, sprawdź parametry.");
      break;
    }
  }

  return {
    loanAmount: loanAmount,
    finalInstallments: monthCount,
    totalInterest: totalInterest,
    baseMonthlyPayment: baseMonthlyPayment,
    monthlyPaymentPlusOver: baseMonthlyPayment + monthlyOverpayment
  };
}

/** Formatuje liczby jako walutę w PLN. */
function formatCurrency(val) {
  return val.toLocaleString('pl-PL', {
    style: 'currency',
    currency: 'PLN'
  });
}

/** Główna funkcja – pobiera dane i wyświetla wyniki dla wszystkich trzech scenariuszy (zakładka 1). */
function calculateAll() {
  // PARAMETRY WSPÓLNE
  const propertyValue = parseFloat(document.getElementById('propertyValue').value);
  const yearlyInterestRate = parseFloat(document.getElementById('yearlyInterestRate').value);

  // SCENARIUSZ 1
  const ownContribution1 = parseFloat(document.getElementById('ownContribution1').value);
  const loanTermYears1 = parseFloat(document.getElementById('loanTermYears1').value);
  const monthlyOverpayment1 = parseFloat(document.getElementById('monthlyOverpayment1').value);

  // SCENARIUSZ 2
  const ownContribution2 = parseFloat(document.getElementById('ownContribution2').value);
  const loanTermYears2 = parseFloat(document.getElementById('loanTermYears2').value);
  const monthlyOverpayment2 = parseFloat(document.getElementById('monthlyOverpayment2').value);

  // SCENARIUSZ 3
  const ownContribution3 = parseFloat(document.getElementById('ownContribution3').value);
  const loanTermYears3 = parseFloat(document.getElementById('loanTermYears3').value);
  const monthlyOverpayment3 = parseFloat(document.getElementById('monthlyOverpayment3').value);

  // OBLICZENIA
  const result1 = calculateScenario(propertyValue, yearlyInterestRate, ownContribution1, loanTermYears1, monthlyOverpayment1);
  const result2 = calculateScenario(propertyValue, yearlyInterestRate, ownContribution2, loanTermYears2, monthlyOverpayment2);
  const result3 = calculateScenario(propertyValue, yearlyInterestRate, ownContribution3, loanTermYears3, monthlyOverpayment3);

  // WYPEŁNIANIE TABELI – SCENARIUSZ 1
  document.getElementById('loanAmount1').textContent = formatCurrency(result1.loanAmount);
  document.getElementById('baseMonthlyPayment1').textContent = formatCurrency(result1.baseMonthlyPayment);
  document.getElementById('monthlyPaymentPlusOver1').textContent = formatCurrency(result1.monthlyPaymentPlusOver);
  document.getElementById('finalInstallments1').textContent =
    result1.finalInstallments + " mies. (" + (result1.finalInstallments / 12).toFixed(1) + " lat)";
  document.getElementById('totalInterest1').textContent = formatCurrency(result1.totalInterest);

  // SCENARIUSZ 2
  document.getElementById('loanAmount2').textContent = formatCurrency(result2.loanAmount);
  document.getElementById('baseMonthlyPayment2').textContent = formatCurrency(result2.baseMonthlyPayment);
  document.getElementById('monthlyPaymentPlusOver2').textContent = formatCurrency(result2.monthlyPaymentPlusOver);
  document.getElementById('finalInstallments2').textContent =
    result2.finalInstallments + " mies. (" + (result2.finalInstallments / 12).toFixed(1) + " lat)";
  document.getElementById('totalInterest2').textContent = formatCurrency(result2.totalInterest);

  // SCENARIUSZ 3
  document.getElementById('loanAmount3').textContent = formatCurrency(result3.loanAmount);
  document.getElementById('baseMonthlyPayment3').textContent = formatCurrency(result3.baseMonthlyPayment);
  document.getElementById('monthlyPaymentPlusOver3').textContent = formatCurrency(result3.monthlyPaymentPlusOver);
  document.getElementById('finalInstallments3').textContent =
    result3.finalInstallments + " mies. (" + (result3.finalInstallments / 12).toFixed(1) + " lat)";
  document.getElementById('totalInterest3').textContent = formatCurrency(result3.totalInterest);

  // Pokazanie sekcji z wynikami
  document.getElementById('results-section').style.display = 'block';
}

/* 
  ===============================
  KOD ZAKŁADKI 2
  ===============================
*/

/**
 * Druga funkcja – automatycznie przeszukuje zakres wkładu własnego (w pewnym kroku)
 * i kilka podstawowych okresów kredytowania. Dla każdego wariantu oblicza maksymalną
 * nadpłatę (jeśli jest możliwa), by cała miesięczna płatność nie przekraczała zadanego
 * maksimum. Następnie wybiera 3 warianty z najmniejszym kosztem odsetek.
 */
function calculateSmartScenarios() {
  // Pobranie parametrów
  const propertyValue = parseFloat(document.getElementById('propertyValueAuto').value);
  const yearlyInterestRate_h = parseFloat(document.getElementById('yearlyInterestRateAuto').value);
  const minWklad = parseFloat(document.getElementById('minWklad').value);
  const maxWklad = parseFloat(document.getElementById('maxWklad').value);
  const maxMonthlyPayment = parseFloat(document.getElementById('maxMonthlyPayment').value);

  // Ustalamy listę możliwych okresów spłaty (lat)
  const possibleLoanYears = [15, 20, 25, 30, 35];

  // Krok, co ile złotych zwiększać wkład (dla przykładu 20k)
  const step = 20000;

  let allScenarios = [];

  for (let wk = minWklad; wk <= maxWklad; wk += step) {
    // Obliczamy kapitał kredytu
    const loanAmount = propertyValue - wk;
    if (loanAmount <= 0) {
      // jeżeli wkład przewyższa wartość, to nie ma kredytu => pomijamy
      continue;
    }

    for (const years of possibleLoanYears) {
      // Najpierw (bez nadpłaty) obliczamy miesięczną ratę
      const monthlyInterestRate = (yearlyInterestRate_h / 100.0) / 12.0;
      const totalInstallments = years * 12;

      let baseMonthlyPayment;
      if (monthlyInterestRate > 0) {
        baseMonthlyPayment = loanAmount *
          (monthlyInterestRate * Math.pow(1 + monthlyInterestRate, totalInstallments)) /
          (Math.pow(1 + monthlyInterestRate, totalInstallments) - 1);
      } else {
        baseMonthlyPayment = loanAmount / totalInstallments;
      }

      // Sprawdzamy, czy sama rata nie przekracza maxMonthlyPayment
      if (baseMonthlyPayment > maxMonthlyPayment) {
        // Zbyt duża rata, pomijamy
        continue;
      }

      // Obliczamy, ile zostaje na nadpłatę
      const leftoverForOverpayment = maxMonthlyPayment - baseMonthlyPayment;
      // Mamy do dyspozycji leftoverForOverpayment na nadpłatę
      // Symulacja spłaty z leftoverForOverpayment
      let balance = loanAmount;
      let totalInterest = 0.0;
      let monthCount = 0;

      const monthlyOverpayment = leftoverForOverpayment;

      while (balance > 0) {
        monthCount++;
        const interestPart = balance * monthlyInterestRate;
        let payment = baseMonthlyPayment + monthlyOverpayment;

        if (payment > balance + interestPart) {
          payment = balance + interestPart;
        }
        const capitalPart = payment - interestPart;
        balance -= capitalPart;
        totalInterest += interestPart;

        if (monthCount > 1200) {
          console.warn("Przekroczono 1200 rat. Dane: wkład=", wk, "lata=", years);
          break;
        }
      }

      // Zapisujemy scenariusz
      allScenarios.push({
        loanYears: years,
        wk: wk,
        loanAmount: loanAmount,
        monthlyBase: baseMonthlyPayment,
        leftoverForOverpayment: leftoverForOverpayment,
        finalInstallments: monthCount,
        totalInterest: totalInterest
      });
    }
  }

  // Sortujemy wg najniższego kosztu odsetek
  allScenarios.sort((a, b) => a.totalInterest - b.totalInterest);

  // Bierzemy top 3
  const top3 = allScenarios.slice(0, 3);

  // Wyświetlenie wyników w tabeli
  const tbody = document.getElementById('autoResultsTableBody');
  tbody.innerHTML = ""; // czyścimy stare wyniki

  top3.forEach((scen, index) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${index + 1}</td>
      <td>${scen.loanYears}</td>
      <td>${formatCurrency(scen.wk)}</td>
      <td>${formatCurrency(scen.loanAmount)}</td>
      <td>${scen.finalInstallments} mies. (${(scen.finalInstallments / 12).toFixed(1)} lat)</td>
      <td>${formatCurrency(scen.monthlyBase)}</td>
      <td>${formatCurrency(scen.leftoverForOverpayment)}</td>
      <td>${formatCurrency(scen.totalInterest)}</td>
      <td>${formatCurrency(scen.monthlyBase + scen.leftoverForOverpayment)}</td>
    `;
    tbody.appendChild(tr);
  });

  // Pokażemy sekcję z wynikami (tylko jeśli cokolwiek znaleziono)
  if (top3.length > 0) {
    document.getElementById('autoResultsSection').style.display = 'block';
  } else {
    // Jeśli brak wyników, wyświetlamy pustą informację
    document.getElementById('autoResultsSection').style.display = 'block';
    tbody.innerHTML = `<tr><td colspan="9" class="text-center text-danger">
      Nie znaleziono żadnych możliwych konfiguracji (spróbuj zwiększyć maksymalną płatność lub zmniejszyć minimalny wkład).
    </td></tr>`;
  }
}
</script>
</body>
</html>
